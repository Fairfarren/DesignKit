<!doctype html>
<html dir="ltr" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0"
    />
    <title>Stencil Component Starter</title>

    <script type="module" src="/build/designkit.esm.js"></script>
    <script nomodule src="/build/designkit.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
      }

      .box {
        width: 100vw;
        height: 1080px;
        border: 2px solid black;
        box-sizing: border-box;
      }
    </style>
  </head>

  <body>
    <div class="box">
      <kit-box id="kitBox" width="1080" height="1920"></kit-box>
    </div>

    <div>
      <div>
        <button onclick="init()">init two data in list</button>
      </div>
      <div>
        <button onclick="add()">addImage</button>
      </div>
      <div>
        <button onclick="addText()">addText</button>
      </div>
      <div>
        <button onclick="getList()">getList</button>
      </div>
    </div>

    <div>
      ÂΩìÂâçÈÄâ‰∏≠Êï∞ÊçÆ:
      <span id="currentDataJson" contenteditable="true"></span>
      <div>
        <button onclick="updateCurrentData()">Á°ÆÂÆöÊõ¥ÊîπÂèÇÊï∞</button>
      </div>
    </div>
  </body>
  <script>
    const image = new Image()
    image.src =
      'https://material-center.meitudata.com/material/image/62fa22ac354485399.png'
    image.crossOrigin = 'anonymous'
    const defaultImage = {
      id: new Date().getTime(),
      width: 1080,
      height: 1920,
      x: 0,
      y: 0,
      image,
      type: 'image',
    }

    const defaultText = {
      id: new Date().getTime() + 1,
      width: 100,
      height: 100,
      x: 0,
      y: 0,
      text: '‰Ω†Â•Ω‰∏ñÁïå‰Ω†Â•Ω‰∏ñÁïå1234567890ü§îabcdefghijklmnopqrstuvwxyz',
      type: 'text',
      fontSize: 32,
      fontFamily: 'cursive',
      color: '#db3f9178',
      fontWeight: 'bold',
      fontStyle: 'italic',
      decoration: 'line-through',
    }

    let currentData = {}
    // Ê∑ªÂä†‰∫ã‰ª∂ÁõëÂê¨Âô®
    document.addEventListener('DOMContentLoaded', function () {
      const kitBox = document.querySelector('#kitBox')
      kitBox.addEventListener('currentDataChange', function (event) {
        currentDataChange(event.detail)
      })
    })

    function init() {
      const kitBox = document.querySelector('#kitBox')
      kitBox.init([defaultImage, defaultText])
    }

    function add() {
      const kitBox = document.querySelector('#kitBox')
      kitBox.add(defaultImage)
    }

    function addText() {
      const kitBox = document.querySelector('#kitBox')
      kitBox.add(defaultText)
    }

    async function getList() {
      const kitBox = document.querySelector('#kitBox')
      const list = await kitBox.getDomList()
      console.log(list)
    }

    function currentDataChange(data) {
      currentData = data
      document.querySelector('#currentDataJson').innerText =
        JSON.stringify(data)
    }

    function updateCurrentData() {
      const currentDataJson =
        document.querySelector('#currentDataJson').innerText
      try {
        const data = JSON.parse(currentDataJson)
        const kitBox = document.querySelector('#kitBox')
        if (data.type === 'image') {
          data.image = currentData.image
        }
        kitBox.updateCurrentData(data)
      } catch (error) {
        console.error('Invalid JSON format:', error)
      }
    }
  </script>
</html>
